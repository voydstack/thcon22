#include "crypto.h"

void get_random_bytes(char *buffer, size_t size) {
    int filefd;

    if ((filefd = open("/dev/urandom", O_RDONLY)) == -1) {
        perror("open");
        exit(1);
    }

    if (read(filefd, buffer, size) < 0) {
        perror("read");
        exit(1);
    }

    close(filefd);
}

void encrypt (char *buffer, size_t size, unsigned char key) {    
    for (int i = 0; i < size; key = buffer[i++]) {
        buffer[i] ^= key;
    }
}

void decrypt(char *buffer, size_t size, unsigned char key) {
    unsigned char k;

    for (int i = size - 1; i >= 0; i--) {
        buffer[i] ^= buffer[i-1];
    }

    buffer[0] ^= key;
}